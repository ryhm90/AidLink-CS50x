{% extends "layout.html" %}
{% block title %}Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©{% endblock %}
{% block main %}
<script>
    var csrfToken = "{{ csrf_token() }}";
</script>

<h4 class="mb-4">ğŸ› ï¸ ØªØ³Ù„ÙŠÙ… Ù…Ø¹Ø¯Ø§Øª Ø´Ø®ØµÙŠØ©</h4>

<form id="searchForm" class="mb-3" method="POST">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <div class="input-group">
        <input type="text" name="nono" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ" required>
        <button type="submit" class="btn btn-primary">Ø¨Ø­Ø«</button>
    </div>
</form>

<div id="items_section">
    {% include "partials/items_section.html" %}
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ§Ø¯ -->
<div class="modal fade" id="additemsModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <form id="addItemForm">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">

          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <input type="hidden" name="offi_no" value="{{ emp.nono if emp }}">
          <input type="hidden" name="offi_name" value="{{ emp.name if emp }}">
          <input type="hidden" name="offi_addres" value="{{ emp.addres if emp }}">
          <input type="hidden" name="offi_cost_name" value="{{ emp.locat_na if emp }}">
          <input type="hidden" name="offi_cost_no" value="{{ emp.locat_no if emp }}">

          <div class="mb-3">
            <label class="form-label">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</label>
            <select name="moad_name" class="form-select" required>
              {% for item in moad %}
                <option value="{{ item.name }}">{{ item.name }} (Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: {{ item.stock - item.delivered }})</option>
              {% endfor %}
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…</label>
            <input type="date" name="date_astlam" class="form-control" required>
          </div>

        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">ğŸ’¾ Ø­ÙØ¸</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø­Ø°Ù -->
<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog">
    <form id="deleteItemForm">
      <input type="hidden" name="id" id="delete_id">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ</p>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-danger">ğŸ—‘ï¸ Ø­Ø°Ù</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
      </div>
    </form>
  </div>
</div>

<script>
document.getElementById('searchForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  const form = e.target;
  const res = await fetch('/items', {
    method: 'POST',
    body: new FormData(form)
  });
  const html = await res.text();
  document.getElementById('items_section').innerHTML = html;
});

document.getElementById('addItemForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  const form = e.target;
  const res = await fetch('/items/add', {
    method: 'POST',
    body: new FormData(form)
  });
  if (res.ok) {
    const html = await res.text();
    document.getElementById('items_section').innerHTML = html;
    bootstrap.Modal.getInstance(document.getElementById('additemsModal')).hide();
  }
});

document.getElementById('deleteItemForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  const form = e.target;
  const res = await fetch('/items/delete', {
    method: 'POST',
    body: new FormData(form)
  });
  if (res.ok) {
    const html = await res.text();
    document.getElementById('items_section').innerHTML = html;
    bootstrap.Modal.getInstance(document.getElementById('deleteModal')).hide();
  }
});

function confirmDelete(id) {
  document.getElementById('delete_id').value = id;
  new bootstrap.Modal(document.getElementById('deleteModal')).show();
}
</script>

{% endblock %}
