{% if emp %}


<div class="card bg-light p-3 mb-3">
  <div class="row small">
    <div class="col-md-4 mb-2">
      <strong>ุงูุงุณู:</strong> {{ emp.name }}<br>
      <strong>ููุน ุงูุนูู:</strong> {{ emp.type_work }}
    </div>
    <div class="col-md-4 mb-2">
      <strong>ุงูุฌูุณ:</strong> {{ emp.six_type }}<br>
      <strong>ุงูุญุงูุฉ ุงูุงุฌุชูุงุนูุฉ:</strong> {{ emp.mared }}<br>
      <strong>ูููุน ุงูุนูู:</strong> {{ emp.locat_na }}
    </div>
    <div class="col-md-4 mb-2">
      <strong>ุชุงุฑูุฎ ุงูุชุนููู:</strong> {{ emp.date1 }}<br>
      <strong>ุงูุนููุงู:</strong> {{ emp.addres }}
    </div>
  </div>
  <div class="text-center mt-2">
    <button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#newCheckupModal">
      โ ูุญุต ุฌุฏูุฏ
    </button>
    </div>

</div>

<div id="previous-checkups">
  <h5 class="mt-4">ุณุฌู ุงููุญูุตุงุช ุงูุณุงุจูุฉ</h5>
  <div style="overflow-x: auto; max-height: 350px;">
    <table class="table table-bordered text-center small">
      <thead class="table-light">
        <tr>
          <th>ุชุงุฑูุฎ ุงููุญุต</th>
          <th>ุชุงุฑูุฎ ุงูุฅุนุงุฏุฉ</th>
          <th>ุงูุชุดุฎูุต</th>
          <th>ุงูุฅุฌุฑุงุกุงุช</th>
        </tr>
      </thead>
      <tbody>
        {% for row in checkups %}
        <tr>
          <td>{{ row.first_date.strftime('%Y-%m-%d') if row.first_date else '' }}</td>
          <td>{{ row.return_date.strftime('%Y-%m-%d') if row.return_date else '-' }}</td>
          <td>{{ row.sike or '-' }}</td>
          <td>
            <!-- ุฃููููุฉ ุงูุชุนุฏูู -->
            <a href="#" class="text-warning me-2" data-bs-toggle="modal" data-bs-target="#editModal_{{ loop.index }}">
              <i class="bi bi-pencil-square fs-5"></i>
            </a>
            <!-- ุฃููููุฉ ุงูุญุฐู -->
            <a href="#" class="text-danger" data-bs-toggle="modal" data-bs-target="#deleteModal_{{ loop.index }}">
              <i class="bi bi-trash fs-5"></i>
            </a>

            <!-- โ Modal ุงูุชุนุฏูู -->
<div class="modal fade" id="editModal_{{ loop.index }}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <form id="updateForm_{{ loop.index }}" data-bs-target="editModal_{{ loop.index }}" onsubmit="event.preventDefault(); updateCheckup('updateForm_{{ loop.index }}')" class="modal-content">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <input type="hidden" name="nono" value="{{ emp.nono }}">
      <input type="hidden" name="first_date" value="{{ row.first_date }}">

      <div class="modal-header bg-warning">
        <h5 class="modal-title text-white">โ๏ธ ุชุนุฏูู ุงููุญุต</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div class="row mb-3">
          <div class="col-md-6">
            <label>ุชุงุฑูุฎ ุงููุญุต ุงูุฃููู</label>
            <input type="date" name="first_date" class="form-control" value="{{ row.first_date.strftime('%Y-%m-%d') if row.first_date }}">
          </div>
          <div class="col-md-6">
            <label>ุชุงุฑูุฎ ุงูุฅุนุงุฏุฉ</label>
            <input type="date" name="return_date" class="form-control" value="{{ row.return_date.strftime('%Y-%m-%d') if row.return_date }}">
          </div>
          <div class="col-md-6">
            <label>ุงูุชุดุฎูุต ุงูุนุงู</label>
            <input type="text" name="sike" class="form-control" value="{{ row.sike }}">
          </div>
        </div>
      
        <table class="table table-bordered text-center small">
          <thead class="table-light">
            <tr><th>ููุน ุงููุญุต</th><th>ุงููุชูุฌุฉ</th><th>ุงูุฅุฌุฑุงุก</th></tr>
          </thead>
          <tbody>
            {% for label, result_field, action_field in [
              ("ูุญุต ุงูุณุฑูุฑ", "result_bed", "action_bed"),
              ("ูุญุต ุงููุธุฑ", "result_see", "action_see"),
              ("ูุญุต ุงูุฑุฆุฉ", "result_lung", "action_lung"),
              ("ูุญุต ุงูุณูุน", "result_hearring", "action_hearring"),
              ("ุชุฎุทูุท ุงูููุจ", "result_hart", "action_hart"),
              ("ุงููุญูุตุงุช ุงููุฎุจุฑูุฉ", "result_labortory_tests", "action_labortory_tests"),
              ("ุงูุตุญุฉ ุงูููุณูุฉ", "result_health_anevsah", "action_health_anevsah"),
              ("ุงูููุงูุฉ ุงูุจุฏููุฉ", "result_fitness", "action_fitness")
            ] %}
            <tr>
              <td>{{ label }}</td>
              <td><input type="text" name="{{ result_field }}" class="form-control form-control-sm text-center" value="{{ row[result_field] }}"></td>
              <td><input type="text" name="{{ action_field }}" class="form-control form-control-sm text-center" value="{{ row[action_field] }}"></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="modal-footer">
        <button type="submit" class="btn btn-warning">๐พ ุชุนุฏูู</button>
      </div>
    </form>
  </div>
</div>


            <!-- Delete Modal -->
            <div class="modal fade" id="deleteModal_{{ loop.index }}" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog">
                <form id="deleteForm_{{ loop.index }}" method="POST" class="modal-content" onsubmit="event.preventDefault(); deleteCheckup('deleteForm_{{ loop.index }}')">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <input type="hidden" name="nono" value="{{ emp.nono }}">
                  <input type="hidden" name="first_date" value="{{ row.first_date }}">
                  <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">๐ ุชุฃููุฏ ุงูุญุฐู</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                  </div>
                  <div class="modal-body">
                    ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงููุญุต ุจุชุงุฑูุฎ <strong>{{ row.first_date.strftime('%Y-%m-%d') }}</strong>ุ
                  </div>
                  <div class="modal-footer">
                    <button type="submit" class="btn btn-danger">ูุนูุ ุญุฐู</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅูุบุงุก</button>
                  </div>
                </form>
              </div>
            </div>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="4">ูุง ุชูุฌุฏ ูุญูุตุงุช ูุณุฌูุฉ</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if total is defined %}
  {% set total_pages = (total // per_page) + (1 if total % per_page else 0) %}
{% set visible_pages = 2 %}
{% set middle_range = 2 %}

{% if total_pages > 1 %}
<nav aria-label="Page navigation">
<ul class="pagination justify-content-center mt-4">

  <!-- ุฃูู ุตูุญุชูู -->
  {% for p in range(1, visible_pages + 1) %}
    {% if p <= total_pages %}
    <li class="page-item {% if p == page %}active{% endif %}">
      <a class="page-link" href="{{ url_for('checkup_page', page=p, nono=nono) }}">{{ p }}</a>
    </li>
    {% endif %}
  {% endfor %}

  {% if page > visible_pages + middle_range + 1 and total_pages > visible_pages * 2 %}
    <li class="page-item disabled"><span class="page-link">...</span></li>
  {% endif %}

  <!-- ุตูุญุงุช ุญูู ุงูุตูุญุฉ ุงูุญุงููุฉ -->
  {% for p in range(page - middle_range, page + middle_range + 1) %}
    {% if p > visible_pages and p < total_pages - visible_pages + 1 %}
      <li class="page-item {% if p == page %}active{% endif %}">
        <a class="page-link" href="{{ url_for('checkup_page', page=p, nono=nono) }}">{{ p }}</a>
      </li>
    {% endif %}
  {% endfor %}

  {% if page < total_pages - visible_pages - middle_range and total_pages > visible_pages * 2 %}
    <li class="page-item disabled"><span class="page-link">...</span></li>
  {% endif %}

  <!-- ุขุฎุฑ ุตูุญุชูู -->
  {% for p in range(total_pages - visible_pages + 1, total_pages + 1) %}
    {% if p > visible_pages %}
    <li class="page-item {% if p == page %}active{% endif %}">
      <a class="page-link" href="{{ url_for('checkup_page', page=p, nono=nono) }}">{{ p }}</a>
    </li>
    {% endif %}
  {% endfor %}

</ul>
</nav>
{% endif %}
{% endif %}

</div>
<!-- Modal: ูุญุต ุฌุฏูุฏ -->
<div class="modal fade" id="newCheckupModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <form class="modal-content" id="checkup-form">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <input type="hidden" name="nono" value="{{ emp.nono }}">
      <div class="modal-header">
        <h5 class="modal-title">๐ฉบ ุฅุถุงูุฉ ูุญุต ุฌุฏูุฏ</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="row mb-3">
          <div class="col-md-6">
            <label>ุชุงุฑูุฎ ุงููุญุต ุงูุฃููู</label>
            <input type="date" name="first_date" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label>ุชุงุฑูุฎ ุงูุฅุนุงุฏุฉ</label>
            <input type="date" name="return_date" class="form-control">
          </div>
        </div>
        <div class="mb-3">
          <label>ุงูุชุดุฎูุต ุงูุนุงู</label>
          <input type="text" name="sike" class="form-control">
        </div>

        <table class="table table-bordered text-center small">
          <thead class="table-light"><tr><th>ููุน ุงููุญุต</th><th>ุงููุชูุฌุฉ</th><th>ุงูุฅุฌุฑุงุก</th></tr></thead>
          <tbody>
            {% for label, result_field, action_field in [
              ("ูุญุต ุงูุณุฑูุฑ", "result_bed", "action_bed"),
              ("ูุญุต ุงููุธุฑ", "result_see", "action_see"),
              ("ูุญุต ุงูุฑุฆุฉ", "result_lung", "action_lung"),
              ("ูุญุต ุงูุณูุน", "result_hearring", "action_hearring"),
              ("ุชุฎุทูุท ุงูููุจ", "result_hart", "action_hart"),
              ("ุงููุญูุตุงุช ุงููุฎุจุฑูุฉ", "result_labortory_tests", "action_labortory_tests"),
              ("ุงูุตุญุฉ ุงูููุณูุฉ", "result_health_anevsah", "action_health_anevsah"),
              ("ุงูููุงูุฉ ุงูุจุฏููุฉ", "result_fitness", "action_fitness")
            ] %}
            <tr>
              <td>{{ label }}</td>
              <td><input type="text" name="{{ result_field }}" class="form-control form-control-sm text-center"></td>
              <td><input type="text" name="{{ action_field }}" class="form-control form-control-sm text-center"></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" onclick="saveCheckup()" class="btn btn-success">๐พ ุญูุธ</button>
      </div>
    </form>
  </div>
  
</div>

{% endif %}