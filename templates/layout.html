<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <meta name="viewport" content="initial-scale=1, width=device-width">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='styles.css') }}" rel="stylesheet">
    <title>{% block title %}{% endblock %}</title>
    
    <style>
        [data-theme="dark"] body {
            background-color: #121212;
            color: #f1f1f1;
        }

        [data-theme="dark"] .navbar,
        [data-theme="dark"] .offcanvas,
        [data-theme="dark"] footer,
        [data-theme="dark"] .card,
        [data-theme="dark"] .alert {
            background-color: #1e1e1e !important;
            color: #f1f1f1 !important;
        }

        [data-theme="dark"] .nav-link,
        [data-theme="dark"] .navbar-brand,
        [data-theme="dark"] .offcanvas-title {
            color: #f1f1f1 !important;
        }

        [data-theme="dark"] .btn-close {
            filter: invert(1);
        }

        .navbar-user-info {
            display: flex;
            align-items: center;
            margin-left: 10px;
        }

        .vertical-line {
            border-left: 1px solid #000;
            height: 30px;
            margin: 0 10px;
        }

        .user-name, .user-org, .user-role {
            margin-left: 10px;
        }

        .navbar-nav .nav-item {
            margin-right: 15px;
        }
        
    </style>
</head>

<body>
    <script>
        // عند فتح أي مودال: اجعل باقي الصفحة غير قابلة للتفاعل
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
          modal.addEventListener('show.bs.modal', () => {
            document.getElementById('main-content')?.setAttribute('inert', '');
          });
      
          modal.addEventListener('hidden.bs.modal', () => {
            document.getElementById('main-content')?.removeAttribute('inert');
          });
        });
      </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.offcanvas').forEach(function (offcanvasEl) {
                offcanvasEl.addEventListener('hidden.bs.offcanvas', function () {
                    document.body.classList.remove('offcanvas-backdrop', 'modal-open');
                    document.querySelectorAll('.offcanvas-backdrop').forEach(el => el.remove());
                });
            });
        });
    </script>

<header>
    <nav class="navbar navbar-light bg-light shadow-sm px-3 justify-content-between">
        {% if session.get("id_no") %}
        
        <button class="btn btn-lg border-0 bg-transparent shadow-none text-secondary" type="button" 
                data-bs-toggle="offcanvas" data-bs-target="#offcanvasMenu">
            <i class="bi bi-list fs-1"></i>
        </button>
        {% endif %}
        <a class="navbar-brand mx-auto fw-bold" href="/">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="شعار الموقع" height="100">
        </a>
        <button class="btn btn-sm bg-transparent text-secondary border-0" id="toggleThemeBtn" title="تبديل الوضع الليلي">
            <i class="bi bi-moon-stars-fill fs-4"></i>
        </button>
    </nav>
</header>

{% if session.get("id_no") %}
<div class="offcanvas offcanvas-end" id="offcanvasMenu">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title">القائمة</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">

        <ul class="nav flex-column">

            <li class="nav-item">
              <a class="nav-link fw-bold" href="/employee">👤 معلومات الموظفين</a>
            </li>
          
            <li class="nav-item">
              <a class="nav-link fw-bold" href="/checkup">🩺 الفحوصات</a>
            </li>
          
            <li class="nav-item">
              <a class="nav-link fw-bold" href="/help">💰 المساعدات المالية</a>
            </li>
          
            <li class="nav-item">
              <span class="nav-link fw-bold">🧤 معدات الوقاية الشخصية</span>
              <ul class="list-unstyled ps-3">
                <li><a class="nav-link" href="/equipment">📋 إدارة المعدات</a></li>
                <li><a class="nav-link" href="/items_handle">صرف مستلزمات شخصية</a></li>
              </ul>
            </li>
            <li class="nav-item">
                <a class="nav-link fw-bold" href="/reports">📊 التقارير</a>
              </li>
            <hr>
            <li class="nav-item"><span class="nav-link disabled">{{ session.get('department') }}</span></li>
            <li class="nav-item"><a class="nav-link text-danger fw-bold" href="/logout">تسجيل الخروج</a></li>
          </ul>
    </div>
</div>
{% endif %}

<!-- ✅ المحتوى -->
<div class="container py-5 text-center">
    {% block main %}{% endblock %}
</div>

<!-- ✅ Toast Notification Container -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100;">
    <!-- إضافة -->
    <div id="successToast" class="toast align-items-center text-white bg-success border-0" role="alert">
        <div class="d-flex">
            <div class="toast-body">✅ تم الحفظ بنجاح</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    </div>

    <!-- تعديل -->
    <div id="successToastUpdate" class="toast align-items-center text-white bg-warning border-0" role="alert">
        <div class="d-flex">
            <div class="toast-body">✏️ تم التعديل بنجاح</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    </div>

    <!-- حذف -->
    <div id="successToastDelete" class="toast align-items-center text-white bg-danger border-0" role="alert">
        <div class="d-flex">
            <div class="toast-body">🗑️ تم الحذف بنجاح</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    </div>

    <!-- خطأ -->
    <div id="errorToast" class="toast align-items-center text-white bg-danger border-0" role="alert">
        <div class="d-flex">
            <div class="toast-body" id="errorToastMessage">❌ حدث خطأ أثناء العملية</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    </div>
    <div id="successToast" class="toast align-items-center text-bg-success border-0" role="alert" data-bs-delay="3000">
        <div class="d-flex">
          <div class="toast-body">✅ تم إضافة الموظف بنجاح</div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
      </div>
    
      <!-- Toast إشعار الخطأ -->
      <div id="errorToast" class="toast align-items-center text-bg-danger border-0" role="alert" data-bs-delay="3000">
        <div class="d-flex">
          <div class="toast-body" id="errorToastMessage">❌ حدث خطأ أثناء الإضافة</div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
      </div>
</div>

<!-- ✅ التذييل -->
<footer class="mt-5 text-center text-muted">
    <p>© 2025 GFC. جميع الحقوق محفوظة.</p>
</footer>

<!-- ✅ تبديل الوضع الليلي -->
<script>
    const toggleBtn = document.getElementById('toggleThemeBtn');
    if (toggleBtn) {
        toggleBtn.addEventListener("click", function () {
            const root = document.documentElement;
            if (root.getAttribute("data-theme") === "dark") {
                root.removeAttribute("data-theme");
                localStorage.removeItem("theme");
            } else {
                root.setAttribute("data-theme", "dark");
                localStorage.setItem("theme", "dark");
            }
        });
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme === "dark") {
            document.documentElement.setAttribute("data-theme", "dark");
        }
    }
</script>

</body>
</html>
